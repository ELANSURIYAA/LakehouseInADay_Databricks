_____________________________________________
## *Author*: AAVA
## *Created on*: 
## *Description*: Physical data model for Gold layer of DC Health Meter Reports in Medallion architecture
## *Version*: 1
## *Updated on*: 
_____________________________________________

# Databricks Gold Model Physical - DC Health Meter Reports

## 1. Overview

This document defines the comprehensive physical data model for the Gold layer of the Medallion architecture for DC Health Meter Reports. The Gold layer stores curated, aggregated, and dimensional data optimized for analytics and reporting. This model is derived from the Silver layer physical model and the Gold layer logical model, with added id fields and Databricks-specific optimizations.

---

## 2. Gold Layer DDL Scripts

### 2.1 Dimension Tables

#### 2.1.1 Go_Distribution_Center
```
CREATE TABLE IF NOT EXISTS gold.Go_Distribution_Center (
    distribution_center_id BIGINT,
    distribution_center_code VARCHAR(50),
    distribution_center_name VARCHAR(100),
    address VARCHAR(255),
    city VARCHAR(100),
    state VARCHAR(50),
    country VARCHAR(50),
    postal_code VARCHAR(20),
    is_active BOOLEAN,
    load_date DATE,
    update_date DATE,
    source_system VARCHAR(50)
)
USING DELTA
PARTITIONED BY (state);
```

#### 2.1.2 Go_Product
```
CREATE TABLE IF NOT EXISTS gold.Go_Product (
    product_id BIGINT,
    product_code VARCHAR(50),
    product_name VARCHAR(100),
    product_category VARCHAR(50),
    product_subcategory VARCHAR(50),
    is_active BOOLEAN,
    load_date DATE,
    update_date DATE,
    source_system VARCHAR(50)
)
USING DELTA
PARTITIONED BY (product_category);
```

#### 2.1.3 Go_Customer
```
CREATE TABLE IF NOT EXISTS gold.Go_Customer (
    customer_id BIGINT,
    customer_code VARCHAR(50),
    customer_name VARCHAR(100),
    customer_type VARCHAR(50),
    region VARCHAR(50),
    is_active BOOLEAN,
    load_date DATE,
    update_date DATE,
    source_system VARCHAR(50)
)
USING DELTA
PARTITIONED BY (region);
```

### 2.2 Fact Tables

#### 2.2.1 Go_Sales_Fact
```
CREATE TABLE IF NOT EXISTS gold.Go_Sales_Fact (
    sales_fact_id BIGINT,
    distribution_center_id BIGINT,
    product_id BIGINT,
    customer_id BIGINT,
    sales_date DATE,
    quantity_sold INT,
    sales_amount DECIMAL(18,2),
    discount_amount DECIMAL(18,2),
    net_sales_amount DECIMAL(18,2),
    load_date DATE,
    update_date DATE,
    source_system VARCHAR(50)
)
USING DELTA
PARTITIONED BY (sales_date);
```

### 2.3 Error Data Table

#### 2.3.1 Go_Error_Data
```
CREATE TABLE IF NOT EXISTS gold.Go_Error_Data (
    error_id BIGINT,
    table_name VARCHAR(100),
    record_id VARCHAR(100),
    error_message VARCHAR(255),
    error_timestamp TIMESTAMP,
    load_date DATE,
    update_date DATE,
    source_system VARCHAR(50)
)
USING DELTA
PARTITIONED BY (table_name);
```

### 2.4 Audit Table

#### 2.4.1 Go_Audit
```
CREATE TABLE IF NOT EXISTS gold.Go_Audit (
    audit_id BIGINT,
    pipeline_name VARCHAR(100),
    execution_start_time TIMESTAMP,
    execution_end_time TIMESTAMP,
    status VARCHAR(20),
    error_message VARCHAR(255),
    load_date DATE,
    update_date DATE,
    source_system VARCHAR(50)
)
USING DELTA
PARTITIONED BY (pipeline_name);
```

### 2.5 Aggregated Tables

#### 2.5.1 Go_Sales_Summary_By_Product
```
CREATE TABLE IF NOT EXISTS gold.Go_Sales_Summary_By_Product (
    summary_id BIGINT,
    product_id BIGINT,
    sales_date DATE,
    total_quantity_sold INT,
    total_sales_amount DECIMAL(18,2),
    total_discount_amount DECIMAL(18,2),
    total_net_sales_amount DECIMAL(18,2),
    load_date DATE,
    update_date DATE,
    source_system VARCHAR(50)
)
USING DELTA
PARTITIONED BY (sales_date);
```

#### 2.5.2 Go_Sales_Summary_By_Customer
```
CREATE TABLE IF NOT EXISTS gold.Go_Sales_Summary_By_Customer (
    summary_id BIGINT,
    customer_id BIGINT,
    sales_date DATE,
    total_quantity_sold INT,
    total_sales_amount DECIMAL(18,2),
    total_discount_amount DECIMAL(18,2),
    total_net_sales_amount DECIMAL(18,2),
    load_date DATE,
    update_date DATE,
    source_system VARCHAR(50)
)
USING DELTA
PARTITIONED BY (sales_date);
```

### 2.6 Update DDL Script Example

If a new column 'region_code' is added to Go_Distribution_Center:
```
ALTER TABLE gold.Go_Distribution_Center ADD COLUMNS (region_code VARCHAR(20));
```

---

## 3. Data Retention Policies

- Gold layer tables are retained for 7 years to support historical analytics.
- Data older than 7 years is archived to cloud storage (e.g., Azure Data Lake or AWS S3) in Parquet format.
- Error and audit tables are retained for 2 years, with monthly archiving of older records.

---

## 4. Conceptual Data Model Diagram (Tabular)

| Table Name                       | Related Table(s)              | Key Field(s)                  |
|----------------------------------|-------------------------------|-------------------------------|
| Go_Sales_Fact                    | Go_Distribution_Center        | distribution_center_id        |
| Go_Sales_Fact                    | Go_Product                    | product_id                    |
| Go_Sales_Fact                    | Go_Customer                   | customer_id                   |
| Go_Sales_Summary_By_Product      | Go_Product                    | product_id                    |
| Go_Sales_Summary_By_Customer     | Go_Customer                   | customer_id                   |
| Go_Error_Data                    | All Tables                    | table_name, record_id         |
| Go_Audit                         | N/A                           | pipeline_name                 |

---

## 5. ER Diagram Visualization (Graph)

Go_Distribution_Center (distribution_center_id)
    |
    |--< Go_Sales_Fact (distribution_center_id)

Go_Product (product_id)
    |
    |--< Go_Sales_Fact (product_id)
    |
    |--< Go_Sales_Summary_By_Product (product_id)

Go_Customer (customer_id)
    |
    |--< Go_Sales_Fact (customer_id)
    |
    |--< Go_Sales_Summary_By_Customer (customer_id)

Go_Error_Data (table_name, record_id) -- references all tables for error tracking
Go_Audit (pipeline_name) -- audit of pipeline executions

---

## 6. Assumptions & Design Decisions

- All id fields are BIGINT and are required for physical model compliance.
- Partitioning is chosen based on high cardinality and query patterns (e.g., date, region, product_category).
- No primary/foreign key constraints are enforced in Databricks Spark SQL DDL.
- All tables use Delta Lake format for ACID compliance and performance.
- Metadata columns (load_date, update_date, source_system) are included in all tables.
- Data types are chosen for Spark SQL compatibility.
- Error and audit tables are included for operational monitoring.
- Aggregated tables are designed for common reporting needs.
- No unsupported features (e.g., GENERATED ALWAYS AS IDENTITY, UNIQUE, TEXT, DATETIME) are used.

---

## 7. API Cost

apiCost: 0.0000001

---

outputURL : https://github.com/ELANSURIYAA/LakehouseInADay_Databricks/tree/main/DI_Databricks_Gold_Model_Physical
pipelineID : 12372
